<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dziennik kierowcy (PWA)</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">
<link rel="icon" href="icon-192.png" type="image/png">

<style>
  :root{ --primary:#0d6efd; --bg:#f5f7fa; --card:#fff; }
  *{ box-sizing:border-box; }
  body{
    font-family: Arial, sans-serif;
    background: var(--bg);
    margin: 0;
    display:flex;
    flex-direction:column;
    min-height:100vh;
  }
  header{
    background: var(--primary);
    color:#fff;
    padding:16px;
    text-align:center;
    font-size:20px;
    font-weight:bold;
  }
  .container{
    flex:1;
    padding:20px;
    max-width:900px;
    margin:auto;
    display:grid;
    gap:16px;
  }
  .card{
    background:var(--card);
    border-radius:12px;
    box-shadow:0 2px 8px rgba(0,0,0,0.08);
    padding:16px;
  }
  label{font-weight:700;margin:10px 0 6px;display:block;}
  input,select,button{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #d0d7de;
    font-size:15px;
  }
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
  .btn{background:var(--primary);color:#fff;border:none;cursor:pointer;}
  .btn:hover{filter:brightness(.95);}
  .btn-muted{background:#6c757d;}
  .btn-danger{background:#dc3545;}
  table{
    width:100%;
    border-collapse:collapse;
    background:#fff;
    border-radius:10px;
    overflow:hidden;
  }
  th,td{
    padding:10px;
    border-bottom:1px solid #e9ecef;
    text-align:center;
    vertical-align:middle;
  }
  thead th{background:#eef4ff;font-weight:700;}
  footer{text-align:center;padding:14px;color:#666;}
  @media(max-width:760px){.row,.row-3{grid-template-columns:1fr;}}
  @media print{
    header,.no-print,footer{display:none!important;}
    @page{size:A4 landscape;margin:12mm;}
    table{font-size:11px;}
  }
</style>
</head>

<body>
<header>üöõ Dziennik kierowcy</header>

<div class="container">
  <div class="card no-print">
    <div class="row">
      <div>
        <label for="driver">Kierowca</label>
        <input id="driver" oninput="saveHeader()">
      </div>
      <div>
        <label for="car">Nr auta</label>
        <input id="car" oninput="saveHeader()">
      </div>
    </div>

    <div class="row-3">
      <div>
        <label for="type">Rodzaj</label>
        <select id="type">
          <option value="Za≈Çadunek">Za≈Çadunek</option>
          <option value="Roz≈Çadunek">Roz≈Çadunek</option>
        </select>
      </div>
      <div>
        <label for="date">Data</label>
        <input type="date" id="date">
      </div>
      <div>
        <label for="odo">Stan licznika (km)</label>
        <input type="number" id="odo" inputmode="numeric">
      </div>
    </div>

    <label for="place">Miejsce</label>
    <input id="place">

    <div class="row">
      <button class="btn" onclick="addEntry()">‚ûï Dodaj wpis</button>
      <button class="btn-muted" onclick="exportCSV()">üíæ Eksportuj CSV</button>
    </div>
    <div class="row">
      <button class="btn" onclick="window.print()">üìÑ Zapisz jako PDF</button>
      <button class="btn-danger" onclick="clearLog()">üóëÔ∏è Wyczy≈õƒá wszystko</button>
    </div>
  </div>

  <div class="card">
    <table id="pairTable">
      <thead>
        <tr>
          <th>Data Z.</th><th>Miejsce Z.</th><th>Stan licznika</th>
          <th>Data R.</th><th>Miejsce R.</th><th>Stan licznika</th>
          <th>Przebieg (km)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<footer class="no-print">Tw√≥rcy: ≈Åukasz Stasinski & ChatGPT (GPT-5)</footer>

<script>
let entries = [];

if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js")
      .then(()=>console.log("‚úÖ SW zarejestrowany"))
      .catch(err=>console.error("B≈ÇƒÖd SW:", err));
  });
}

function todayStr(){return new Date().toISOString().slice(0,10);}
function persist(){localStorage.setItem("driverLog_pairs",JSON.stringify(entries));}
function load(){
  try{return JSON.parse(localStorage.getItem("driverLog_pairs"))||[];}
  catch{return[];}
}
function saveHeader(){
  localStorage.setItem("driverName",document.getElementById("driver").value);
  localStorage.setItem("carNumber",document.getElementById("car").value);
}
function addEntry(){
  const type=document.getElementById("type").value;
  const date=document.getElementById("date").value||todayStr();
  const place=document.getElementById("place").value.trim();
  const odo=document.getElementById("odo").value.trim();
  if(!place||!odo){alert("Uzupe≈Çnij miejsce i licznik!");return;}
  entries.push({type,date,place,odo:parseInt(odo),ts:Date.now()});
  persist();render();
  document.getElementById("place").value="";
  document.getElementById("odo").value="";
}
function clearLog(){
  if(confirm("Na pewno usunƒÖƒá wszystkie dane?")){
    entries=[];persist();render();
  }
}
function byDate(a,b){return a.date.localeCompare(b.date)||a.ts-b.ts;}
function render(){
  entries=load();
  entries.sort(byDate);
  const tbody=document.querySelector("#pairTable tbody");
  tbody.innerHTML="";
  let loadEntry=null;
  entries.forEach(e=>{
    if(e.type==="Za≈Çadunek"){loadEntry=e;}
    else if(loadEntry){
      const distance=e.odo-loadEntry.odo;
      const row=document.createElement("tr");
      row.innerHTML=`
        <td>${loadEntry.date}</td><td>${loadEntry.place}</td><td>${loadEntry.odo}</td>
        <td>${e.date}</td><td>${e.place}</td><td>${e.odo}</td>
        <td>${distance>0?distance:""}</td>`;
      tbody.appendChild(row);
      loadEntry=null;
    }
  });
}
function exportCSV(){
  let csv="Data Z.,Miejsce Z.,Stan,Data R.,Miejsce R.,Stan,Przebieg\n";
  document.querySelectorAll("#pairTable tbody tr").forEach(tr=>{
    const tds=tr.querySelectorAll("td");
    const row=[...tds].map(td=>td.textContent.replace(/,/g," "));
    csv+=row.join(",")+"\n";
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="dziennik.csv";
  a.click();
}
window.onload=()=>{entries=load();render();};
</script>
</body>
</html>
